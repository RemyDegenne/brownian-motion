\chapter{Debùt Theorem}
\label{chap:debut_theorem}

\section{Monotone class theorem}

% This section may be used also in other chapters of the blueprint. Therefore, depending on where it is used and also how big the proof becomes, we may want to move it somewhere else.
TODO: find the right generality (and some reference) to state the monotone class theorem and write the informal proof. It may be possible to adapt the following theorem: \href{https://leanprover-community.github.io/mathlib4_docs/Mathlib/MeasureTheory/PiSystem.html#MeasurableSpace.DynkinSystem.generateFrom_eq}{MeasurableSpace.DynkinSystem.generateFrom\_eq}.

\begin{definition}[Monotone class]\label{def:monotone_class}
  Let $\mathcal{M}$ be a collection of subsets of a set $X$. We say that $\mathcal{M}$ is a monotone class if it is closed under countable monotone unions and countable monotone intersections, i.e.:
  \begin{enumerate}
    \item if \( A_1, A_2, \ldots \in M \) and \( A_1 \subseteq A_2 \subseteq \cdots \), then
    \( \bigcup_{i=1}^\infty A_i \in M \),
    \item if \( B_1, B_2, \ldots \in M \) and \( B_1 \supseteq B_2 \supseteq \cdots \), then
    \( \bigcap_{i=1}^\infty B_i \in M \).
  \end{enumerate}
  Given a collection $\mathcal{F}$ of subsets of $X$, we call the smallest monotone class containing $\mathcal{F}$ the monotone class generated by $\mathcal{F}$.
\end{definition}

\begin{theorem}[Monotone class theorem]\label{thm:monotone_class}
  Let \(G\) be an algebra of subsets of a set \(X\). Then the monotone class generated by \(G\) coincides with the $\sigma$-algebra generated by \(G\).
\end{theorem}

\begin{proof}
  TODO
\end{proof}

\section{Debut}
The following proof is based on "R.F. Bass, The measurability of hitting times, Electron. Commun. Probab. {\bf 15} (2010), 99--105; MR2606507"
and the successive "R.F. Bass. "Correction to "The measurability of hitting times"." Electron. Commun. Probab. 16 189 - 191, 2011. \url{https://doi.org/10.1214/ECP.v16-1627}"
which is a rather clever and short proof evading the classical proof which uses more complex structures. Note that there exists also an Arxiv version of the paper with the corrections applied (\url{https://arxiv.org/pdf/1001.3619}), we will mostly reference this unified version.


Standard notation in this chapter:
$(\Omega, \mathcal{F} , P)$ is a probability space;
$\mathcal{S}$ is a topological space;
$\pi:\mathbb{R}_{\geq 0}\times\Omega\rightarrow \Omega$ is the projection; $P^*$ is the outer measure associated with $P$.

\begin{definition}[Progressively measurable set]\label{def:progr_meas_set}
  \leanok
  \lean{MeasureTheory.ProgMeasurableSet}
A subset of $[0, \infty) \times \Omega$ is progressively measurable if its indicator is a progressively measurable process.
\end{definition}

\begin{definition}[Debut of a set]\label{def:debut_set}
  \leanok
  \lean{MeasureTheory.Debut}
Let $E \subseteq{} [0, \infty) \times \Omega $, define $D_E = \inf\left\lbrace t \geq 0\ :\ (t, \omega) \in E\right\rbrace$, the debut of $E$.
\end{definition}

\begin{definition}[$\mathcal{K}^0$]\label{def:subsets_compact_RNN_times_measurable}
  \leanok
  \lean{MeasureTheory.𝓚₀}
Let $t>0$. Let $\mathcal{K}^0(t)$ be the collection of subsets of $[0, t] \times \Omega$ of the form $K \times C$, where $K$ is a compact
subset of $[0, t]$ and $C \in \mathcal{F}_t$.
\end{definition}

\begin{definition}[$\mathcal{K}$]\label{def:fin_union_RNN_times_measurable}
  \leanok
  \lean{MeasureTheory.𝓚}
  \uses{def:subsets_compact_RNN_times_measurable}
Let $t>0$. Let $\mathcal{K}(t)$ be the collection of finite unions of elements of $\mathcal{K}^0(t)$.
\end{definition}

\begin{definition}[$\mathcal{K}_\delta$]\label{def:count_inter_of_fin_union_RNN_times_measurable}
  \leanok
  \lean{MeasureTheory.𝓚δ}
  \uses{def:fin_union_RNN_times_measurable}
Let $t>0$. Let $\mathcal{K}_\delta(t)$ be the collection of countable intersections of elements of $\mathcal{K}(t)$.
\end{definition}

\begin{definition}[$t$-approximable set]\label{def:t_approx_set}
  \leanok
  \lean{MeasureTheory.Approximation}
  \uses{def:count_inter_of_fin_union_RNN_times_measurable}
Let $t>0$.
We say $A \in \mathcal{B}[0, t] \times \mathcal{F}_t$ is
$t$-approximable if given $\epsilon > 0$, there exists $B \in \mathcal{K}_\delta (t)$ with $B \subseteq{} A$ and
$$P^∗ (\pi(A)) \leq P^∗ (\pi(B)) + \epsilon,$$
where $\pi$ is the projection over $\Omega$.
\end{definition}

\begin{lemma}\label{lem:iInf_snd_eq_snd_iInf}
  \leanok
  \lean{MeasureTheory.iInf_snd_eq_snd_iInf_of_mem_𝓚δ}
  \uses{def:count_inter_of_fin_union_RNN_times_measurable}
If $B \in \mathcal{K}_\delta (t)$, $\forall n\in \mathbb{N}$, $B_n \in \mathcal{K}^\delta(t)$ and $B_n \searrow B$, then $\pi(B) = \bigcap_{n\in\mathbb{N}} \pi(B_n)$.
\end{lemma}

\begin{proof}
  % See the proof of Lemma 2.2 in the corrected paper.

  For each $\omega \in \Omega$ and each set $C \subseteq [0,+\infty) \times \Omega$, let
  \[S(C)(\omega) = \{s \leq t : (s,\omega) \in C\}.\]

  If $B \in \mathcal{K}_\delta(t)$, then $S(B)(\omega)$
  is compact. In fact, there exists a sequence $A_n \in \mathcal{K}(t)$ such that
  $A_n \searrow B$, therefore $S(A_n)(\omega)$ is compact and $S(A_n)(\omega) \searrow S(B)(\omega)$. In particular, $S(B_n)(\omega)$ is compact for each $n$.

  Now we divide the proof in two cases.

  One possibility is that
  $\bigcap_{n \in \mathbb{N}} S(B_n)(\omega) \neq \emptyset$; in this case, if $s \in \bigcap_{n \in \mathbb{N}} S(B_n)(\omega)$,
  then $(s,\omega) \in B_n$ for each $n$, and so $(s,\omega) \in B$. Therefore,
  $\omega \in \pi(B_n)$ for each $n$ and $\omega \in \pi(B)$.

  The other possibility is that $\bigcap_{n \in \mathbb{N}} S(B_n)(\omega) = \emptyset$.
  Since the sequence $S(B_n)(\omega)$ is a decreasing sequence of compact sets,
    $S(B_n)(\omega) = \emptyset$ for some $n$,
  for otherwise $\bigcap_{n \in \mathbb{N}} S(B_n)(\omega)$ would also be nonempty.
  Therefore $\omega \notin \pi(B_n)$ and $\omega \notin \pi(B)$.

  We conclude that $\omega \in \pi(B)$ if and only if $\omega \in \bigcap_{n \in \mathbb{N}} \pi(B_n)$, hence $\pi(B) = \bigcap_{n \in \mathbb{N}} \pi(B_n)$.
\end{proof}

\begin{lemma}\label{lem:K_delta_of_inter_K_delta}
  \leanok
  \lean{MeasureTheory.measurableSet_snd_of_mem_𝓚δ}
  \uses{def:count_inter_of_fin_union_RNN_times_measurable}
If $B \in \mathcal{K}_\delta (t)$, then $\pi(B) \in \mathcal{F}_t$.
\end{lemma}

\begin{proof}
  \uses{lem:iInf_snd_eq_snd_iInf}
  % See the proof of Lemma 2.2 in the corrected paper.
  By definition of $\mathcal{K}_\delta(t)$, $B = \bigcap_{n\in\mathbb{N}} B_n$ where $B_n \in \mathcal{K}(t)$. Therefore, by Lemma~\ref{lem:iInf_snd_eq_snd_iInf}, \[\pi(B) = \pi \left(\bigcap_{n\in\mathbb{N}} B_n\right) = \bigcap_{n\in\mathbb{N}} \pi(B_n) \in \mathcal{F}_t .\]
\end{proof}

\begin{lemma}\label{lem:measurable_of_t_approx}
  \leanok
  \lean{MeasureTheory.Approximation.measurableSet_snd}
  \uses{def:t_approx_set}
  If $A$ is $t$-approximable, then $\pi(A) \in \mathcal{F}_t$.
\end{lemma}

\begin{proof}
  \uses{lem:K_delta_of_inter_K_delta}
  % See the proof of Lemma 2.3 in the corrected paper.
  Choose $A_n \in \mathcal{K}_\delta(t)$ with $A_n \subseteq A$ and
  $P(\pi(A_n)) \to P^*(\pi(A))$. Let $B_n = A_1 \cup \cdots \cup A_n$ and
  let $B = \bigcup_{n \in \mathbb{N}} B_n$. Then
  $B_n \in \mathcal{K}_\delta(t)$, $B_n \nearrow B$, and $P(\pi(B_n)) \geq P(\pi(A_n)) \to
  P^*(\pi(A))$.
  Moreover, by Lemma~\ref{lem:K_delta_of_inter_K_delta}, $\pi(B_n) \in \mathcal{F}_t$.
  It follows that $\pi(B_n) \nearrow \pi(B)$, and so $\pi(B) \in \mathcal{F}_t$ and
  $$P(\pi(B)) = \lim_{n \to \infty} P(\pi(B_n)) = P^*(\pi(A)).$$

  For each $n$, there exists $C_n \in \mathcal{F}$ such that
  $\pi(A) \subseteq C_n$ and $P(C_n) \leq P^*(\pi(A)) + 1/n$. Setting
  $C = \bigcap_{n \in \mathbb{N}} C_n$, we have $\pi(A) \subseteq C$ and $P^*(\pi(A)) = P(C)$.
  Therefore
  $\pi(B) \subseteq \pi(A) \subseteq C$ and $P(\pi(B)) = P^*(\pi(A)) = P(C)$.
  This implies that $\pi(A) \setminus \pi(B)$ is a $P$-null set, and by
  the completeness assumption, $\pi(A) = (\pi(A) \setminus \pi(B)) \cup \pi(B) \in \mathcal{F}_t$.
\end{proof}

\begin{lemma}\label{lem:exists_B_of_t_approx}
  \leanok
  \lean{MeasureTheory.Approximation.tendsto_measure_diff_B'}
  \uses{def:count_inter_of_fin_union_RNN_times_measurable, def:t_approx_set}
  Suppose $A$ is $t$-approximable. Then, given $\epsilon > 0$, there exists
  $B \in \mathcal{K}_\delta (t)$ such that $P(\pi(A) \setminus \pi(B)) < \epsilon$.
\end{lemma}

\begin{proof}
  \uses{lem:K_delta_of_inter_K_delta}
  % See the proof of Lemma 2.3 in the corrected paper.
  Let $B_n$ and $B$ be as in the proof of Lemma~\ref{lem:measurable_of_t_approx}.
  Then,
  $$\lim_{n \to \infty} P(\pi(A) \setminus \pi(B_n)) = P(\pi(A) \setminus \pi(B)) = 0.$$
\end{proof}

% consider removing this lemma altogether, I think we do not even need it in the proof
\begin{lemma}\label{lem:aux1a}
  \leanok
If $A \subseteq \Omega$, there exists $C \in \mathcal{F}$ such that $A \subseteq C$ and $P^∗(A) = P(C)$.
\end{lemma}

\begin{proof}\leanok
  This is just \verb|MeasureTheory.exists_measurable_superset|.
\end{proof}

\begin{lemma}\label{lem:aux1b}
Let $(A_n)_{n\in\mathbb{N}},A\subseteq \Omega$.
Suppose $A_n \nearrow A$. Then $P^∗(A) = \lim_{n\rightarrow \infty} P^∗(A_n)$.
\end{lemma}

\begin{proof}\leanok
  This is just \verb|Monotone.measure_iUnion| (this is a version with the sup, if needed there is also the version with the limit).
\end{proof}

\begin{definition}[$\mathcal{L}$-sets]\label{def:L_sets}
  \leanok
  \lean{MeasureTheory.𝓛₀, MeasureTheory.𝓛₁, MeasureTheory.𝓛, MeasureTheory.𝓛σ, MeasureTheory.𝓛σδ}
  \uses{def:count_inter_of_fin_union_RNN_times_measurable}
  From hereafter the following sets are needed:

  \begin{itemize}
  \item $\mathcal{L}_0(X) := \left\lbrace A \times B\ :\ A \subseteq X ,\ A \text{ compact},\ B \in \mathcal{K}(t)\right\rbrace$
  \item $\mathcal{L}_1(X )$ the class of finite unions of sets in $\mathcal{L}_0(X )$
  \item $\mathcal{L} (X )$ the class of intersections of countable decreasing sequences in $\mathcal{L}_1(X )$
  \item $\mathcal{L}_\sigma(X )$ be the class of unions of countable increasing sequences of sets in $\mathcal{L} (X )$
  \item $\mathcal{L}_{\sigma\delta}(X )$ the class of intersections of countable decreasing sequences of sets in $\mathcal{L}_\sigma(X )$
  \end{itemize}
\end{definition}

\begin{lemma}\label{lem:exists_cpct_Hausdorff}
  \leanok
  \lean{MeasureTheory.exists_mem_𝓛σδ_of_measurableSet}
  \uses{def:L_sets}
If $A \in \mathcal{B}[0, t] \times \mathcal{F}_t$, there exists a compact Hausdorff space $X$ and $B \in \mathcal{L}_{\sigma\delta}(X )$ such  that $A = \rho^X (B)$.

Where $\rho^X:X\times ([0,t]\times\Omega)\rightarrow [0,t]\times\Omega$ is the projection.
\end{lemma}

\begin{proof}
  \uses{thm:monotone_class}
  % See Lemma 2.5 in the corrected paper.
  %TODO: this proof needs to be expanded in multiple lemmas, for now I just copy pasted it from the paper, but probably we will need to separately define the set M, prove as a lemma that it is a monotone class, etc. We will also need to find the monotone class theorem or prove it ourselves, in the latter case I think we will need to have a section dedicated to it.

  TODO: Reorganize this proof, possibly divide it in multiple lemmas.

  If $A \in \mathcal{K}(t)$, we take $X = [0,1]$, the unit interval with the
  usual topology and $B = X \times A$. Thus the collection $\mathcal{M}$ of
  subsets of $\mathcal{B}[0,t] \times \mathcal{F}_t$
  for which the lemma is satisfied contains $\mathcal{K}(t)$. We will
  show that $\mathcal{M}$ is a monotone class.


  Suppose $A_n \in \mathcal{M}$ with $A_n \downarrow A$. There exist compact Hausdorff
  spaces $X_n$ and sets $B_n \in \mathcal{L}_{\sigma\delta}(X_n)$ such that $A_n = \rho^{X_n}(B_n)$.
  Let $X = \prod_{n=1}^\infty X_n$ be furnished with the product topology. Let
  $\tau_n: X \times [0,t] \times \Omega \to X_n \times [0,t] \times \Omega$ be defined by $\tau_n(x,(s,\omega))
  = (x_n,(s,\omega))$ if $x = (x_1,x_2, \ldots)$. Let $C_n = \tau_n^{-1}(B_n)$
  and let $C = \bigcap_{n \in \mathbb{N}} C_n$. It is easy to check that $\mathcal{L}(X)$ is closed under
  the operations of finite unions and intersections, from which it follows
  that $C \in \mathcal{L}_{\sigma\delta}(X)$. If $(s,\omega) \in A$, then for each $n$ there exists $x_n \in X_n$ such that $(x_n,(s,\omega)) \in B_n$. Note that
  $((x_1,x_2, \ldots),(s,\omega)) \in C$ and therefore $(s,\omega) \in \rho^X(C)$.
  It is straightforward that $\rho^X(C) \subseteq A$, and we conclude
  $A \in \mathcal{M}$.

  Now suppose $A_n \in \mathcal{M}$ with $A_n \uparrow A$. Let $X_n$ and $B_n$ be as before.
  Let $X' = \bigcup_{n=1}^\infty (X_n \times \{n\})$ with the topology generated by
  $\{G \times \{n\}: G \text{ open in } X_n\}$. Let $X$ be the one point
  compactification of $X'$. We can write $B_n = \bigcap_{m \in \mathbb{N}} B_{nm}$ with
  $B_{nm} \in \mathcal{L}_\sigma(X_n)$. Let
  $$C_{nm} = \{((x,n),(s,\omega)) \in X \times [0,t] \times \Omega: x \in X_n, (x,(s,\omega)) \in B_{nm}\},$$
  $C_n = \bigcap_{m \in \mathbb{N}} C_{nm}$, and $C = \bigcup_{n \in \mathbb{N}} C_n$.
  Then $C_{nm} \in \mathcal{L}_\sigma(X)$ and so $C_n \in \mathcal{L}_{\sigma\delta}(X)$.

  If $((x,p),(s,\omega)) \in \bigcap_{m \in \mathbb{N}} \bigcup_{n \in \mathbb{N}} C_{nm}$, then
  for each $m$ there exists $n_m$ such that $((x,p),(s,\omega)) \in C_{n_mm}$.
  This is
  only possible if $n_m = p$ for each $m$. Thus $((x,p), (s, \omega)) \in \bigcap_{m \in \mathbb{N}} C_{pm} = C_p \subseteq C$.
  The other inclusion is easier and we thus obtain $C = \bigcap_{m \in \mathbb{N}}\bigcup_{n \in \mathbb{N}} C_{nm}$,
  which implies $C \in \mathcal{L}_{\sigma\delta}(X)$. We check that
  $A = \rho^X(C)$ along the same lines, and therefore $A \in \mathcal{M}$.


  If $\mathcal{I}^0(t)$ is the collection of sets of the form $[a,b) \times C$, where
  $a < b \leq t$ and $C \in \mathcal{F}_t$, and $\mathcal{I}(t)$ is the collection of finite
  unions of sets in $\mathcal{I}^0(t)$, then $\mathcal{I}(t)$ is an algebra of sets. We
  note that $\mathcal{I}(t)$ generates the $\sigma$-field $\mathcal{B}[0,t] \times \mathcal{F}_t$. A set
  in $\mathcal{I}^0(t)$ of the form $[a,b) \times C$ is the union of sets in $\mathcal{K}^0(t)$
  of the form $[a, b-(1/m)] \times C$, and it
  follows that every set in $\mathcal{I}(t)$ is the increasing union of sets
  in $\mathcal{K}(t)$. Since $\mathcal{M}$ is a monotone
  class containing $\mathcal{K}(t)$, then $\mathcal{M}$ contains $\mathcal{I}(t)$.
  By the monotone class theorem (Theorem~\ref{thm:monotone_class}), $\mathcal{M} = \mathcal{B}[0,t] \times \mathcal{F}_t$.
\end{proof}

\begin{lemma}\label{lem:t_approx_of_Borel_measurable}
  \leanok
  \lean{MeasureTheory.Approximation.of_mem_prod_borel}
  \uses{def:t_approx_set}
If $A \in \mathcal{B}[0, t] \times \mathcal{F}_t$, then $A$ is $t$-approximable.
\end{lemma}

\begin{proof}
  \uses{lem:exists_cpct_Hausdorff}
  % See the proof of Lemma 2.6 in the corrected paper.
  %TODO: expand this proof, this may need some auxiliary lemmas. For now I just copy pasted the proof from the paper

  TODO: Reorganize this proof, possibly divide it in multiple lemmas.

  We first prove that if $H \in \mathcal{L}(X)$, then $\rho^X(H) \in \mathcal{K}_\delta$. If $H \in \mathcal{L}_1(X)$,
  this is clear. Suppose that $H_n \downarrow H$ with each $H_n \in \mathcal{L}_1(X)$.
  If $(s,\omega) \in \bigcap_{n \in \mathbb{N}} \rho^X(H_n)$, there exist
  $x_n \in X$ such that $(x_n,(s,\omega)) \in H_n$. Then there exists a subsequence
  such that $x_{n_k} \to x_\infty$ by the compactness of $X$. Now $(x_{n_k},(s,\omega)) \in H_{n_k}
  \subseteq H_m$ for $n_k$ larger than $m$. For fixed $\omega$, $\{(x,s): (x,(s,\omega)) \in H_m\}$
  is compact, so $(x_\infty,(s,\omega)) \in H_m$ for all $m$. This implies
  $(x_\infty,(s,\omega)) \in H$. The other inclusion is easier and therefore $\bigcap_{n \in \mathbb{N}} \rho^X(H_n) = \rho^X(H)$.
  Since $\rho^X(H_n) \in \mathcal{K}_\delta(t)$, then $\rho^X(H) \in \mathcal{K}_\delta(t)$.
  We also observe that for fixed $\omega$, $\{(x,s):(x,(s,\omega)) \in H\}$
  is compact.

  Now suppose $A \in \mathcal{B}[0,t] \times \mathcal{F}_t$. Then by Lemma~\ref{lem:exists_cpct_Hausdorff}
  there exists a compact Hausdorff space $X$ and $B \in \mathcal{L}_{\sigma\delta}(X)$ such that $A = \rho^X(B)$. We can write
  $B = \bigcap_{n \in \mathbb{N}} B_n$ and $B_n = \bigcup_{m \in \mathbb{N}} B_{nm}$ with $B_n \downarrow B$, $B_{nm} \uparrow B_n$, and $B_{nm} \in \mathcal{L}(X)$.

  Let $a = P^*(\pi(A)) = P^*(\pi \circ \rho^X(B))$ and let $\epsilon > 0$.
  By Lemma~\ref{lem:aux1b},
  $$P^*(\pi \circ \rho^X(B \cap B_{1m})) \uparrow P^*(\pi \circ \rho^X(B \cap B_1))
  = P^*(\pi \circ \rho^X(B)) = a.$$
  Take $m$ large enough so that $P^*(\pi \circ \rho^X(B \cap B_{1m})) > a - \epsilon$,
  let $C_1 = B_{1m}$, and $D_1 = B \cap C_1$.

  We proceed by induction. Suppose we are given sets $C_1, \ldots, C_{n-1}$ and
  sets $D_1, \ldots, D_{n-1}$ with $D_{n-1} = B \cap \left(\bigcap_{i=1}^{n-1} C_i\right)$, $P^*(\pi
  \circ \rho^X(D_{n-1})) > a - \epsilon$, and each $C_i = B_{im_i}$ for
  some $m_i$. Since $D_{n-1} \subseteq B \subseteq B_n$, by Lemma~\ref{lem:aux1b}
  $$P^*(\pi \circ \rho^X(D_{n-1} \cap B_{nm}))
  \uparrow P^*(\pi \circ \rho^X(D_{n-1} \cap B_n))
  = P^*(\pi \circ \rho^X(D_{n-1})).$$
  We can take $m$ large enough so that
  $P^*(\pi \circ \rho^X(D_{n-1} \cap B_{nm})) > a - \epsilon$, let $C_n = B_{nm}$, and $D_n = D_{n-1} \cap C_n$.

  If we let $G_n = C_1 \cap \cdots \cap C_n$ and $G = \bigcap_{n \in \mathbb{N}} G_n = \bigcap_{n \in \mathbb{N}} C_n$, then
  each $G_n$ is in $\mathcal{L}(X)$, hence $G \in \mathcal{L}(X)$. Since $C_n \subseteq B_n$, then
  $G \subseteq \bigcap_{n \in \mathbb{N}} B_n = B$.
  Each $G_n \in \mathcal{L}(X)$ and so by the first paragraph of this proof, for each
  fixed $\omega$ and $n$, $\{(x,s): (x,(s,\omega)) \in G_n\}$
  is compact. Hence, by a proof very similar to that of Lemma~\ref{lem:iInf_snd_eq_snd_iInf},
  $\pi \circ \rho^X(G_n) \downarrow \pi \circ \rho^X(G)$.
  Using the first paragraph of this proof and Lemma~\ref{lem:iInf_snd_eq_snd_iInf},
  we see that $$P(\pi \circ \rho^X(G))
  = \lim_{n \to \infty} P(\pi \circ \rho^X(G_n)) \geq \lim_{n \to \infty} P^*(\pi \circ \rho^X(D_n)) \geq a - \epsilon.$$

  Using the first paragraph of this proof once again, we see that $A$ is $t$-approximable.
\end{proof}

\begin{theorem}\label{thm:debut_of_progr_meas_is_stop_time}
  \leanok
  \lean{MeasureTheory.Debut.isStoppingTime}
  \uses{def:progr_meas_set, def:debut_set}
If $E$ is a progressively measurable set, then $D_E$ is a stopping time.
\end{theorem}

\begin{proof}
  \uses{def:t_approx_set, lem:t_approx_of_Borel_measurable, lem:measurable_of_t_approx}
  % See the proof of Theorem 2.1 in the corrected paper.
  % TODO: It seems we need right continuity of the filtration, should we state it as an assumption?
  Let $E$ be a progressively measurable set and let $A_u = E \cap ([0,u] \times \Omega)$.
  By Lemma~\ref{lem:t_approx_of_Borel_measurable}, $A_u$ is $u$-approximable.
  By Lemma~\ref{lem:measurable_of_t_approx}, $\pi(A_u) \in \mathcal{F}_u$.
  Now fix $t$. If $\omega \in \{D_E \leq t\}$, we see that $\omega \in \pi(A_u)$ for all $u > t$.
  Conversely, if $\omega \in \pi(A_u)$ for all $u > t$, then $\omega \in \{D_E \leq t\}$.
  If $u_1 < u_2$, then $A_{u_1} \subseteq A_{u_2}$ and hence $\pi(A_{u_1}) \subseteq
  \pi(A_{u_2})$. Therefore
  $$\{D_E \leq t\} = \bigcap_{u > t} \pi(A_u) \in \bigcap_{u > t} \mathcal{F}_u = \mathcal{F}_t.$$
  Because $t$ was arbitrary, we conclude $D_E$ is a stopping time.
\end{proof}

\section{Hitting times}

% TODO: do we want to do the same distinction that the paper makes between the hitting time and the entry time?
% In the paper they are defined as follows:
% Entry time: inf{t \geq 0: X_t \in B}
% Hitting time: inf{t > 0: X_t \in B}
% What we call hitting time in Mathlib is actually a generalization of the entry time, but does not completely cover the hitting time. In case we would like to have both we may want to define another version of the hitting time with the strict inequality (essentially with Set.Ioc or Set.Ioo instead of Set.Icc).
% For the moment this does not seem necessary, and in any case the proof for the hitting time relies on the one for the entry time and takes a limit, so we can always add it later if needed.

\begin{theorem}\label{thm:hitting_is_stopping_time}
  \leanok
  \lean{MeasureTheory.hitting_isStoppingTime'}
  \uses{def:progr_meas_set, def:debut_set}
If $X$ is a progressively measurable process taking values in $\mathcal{S}$ and $B$ is a Borel-measurable subset of $\mathcal{S}$, then the hitting time of $X$ in $B$ is a stopping time.
\end{theorem}

\begin{proof}
  \uses{thm:debut_of_progr_meas_is_stop_time}
  % See the proof of Theorem 2.7 in the corrected paper.
  Since $B$ is a Borel subset of $\mathcal{S}$ and $X$ is progressively measurable,
  then $\mathbf{1}_B(X_t)$ is also progressively measurable. The hitting time is then the debut of the set
  $E = \{(s,\omega) : \mathbf{1}_B(X_s(\omega)) = 1\}$, and therefore is a stopping time by Theorem~\ref{thm:debut_of_progr_meas_is_stop_time}.
\end{proof}
