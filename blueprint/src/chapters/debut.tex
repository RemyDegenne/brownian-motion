\chapter{Debut Theorem}
\label{chap:debut_theorem}


\section{Choquet's capacitability theorem}

This section is devoted to the proof of Choquet's capacitability theorem, which is a key ingredient in the proof of the debut theorem. The presentation follows \cite{bichteler2002stochastic} for the definition of analytic sets (that definition changes a lot between sources) and for the general proof steps, and \cite{he2019semimartingale} and the PlanetMath website for many of the proofs of individual lemmas.
Although the definition of analytic sets in \cite{he2019semimartingale} is different, the proofs follow the same general steps and the same ideas, and that book is much more detailed than \cite{bichteler2002stochastic}.

\subsection{Pavings and Compact systems}

A paving is simply a set of sets.

\begin{definition}\label{def:memProd}
  \leanok
  \lean{MeasureTheory.memProd}
The product of two pavings $S$ and $T$ is the set of sets of the form $s \times t$ where $s \in S$ and $t \in T$. We denote that product by $S \times T$.
\end{definition}


\begin{definition}\label{def:memFiniteUnion}
  \leanok
  \lean{MeasureTheory.memFiniteUnion}
For a paving $S$, we denote by $S^{\cup f}$ the set of finite unions of sets in $S$.
\end{definition}


\begin{definition}\label{def:memFiniteInter}
  \leanok
  \lean{MeasureTheory.memFiniteInter}
For a paving $S$, we denote by $S^{\cap f}$ the set of finite intersections of sets in $S$.
\end{definition}


\begin{definition}\label{def:memSigma}
  \leanok
  \lean{MeasureTheory.memSigma}
We denote by $S_\sigma$ the set of countable unions of sets in $S$.
\end{definition}


\begin{definition}\label{def:memDelta}
  \leanok
  \lean{MeasureTheory.memDelta}
We denote by $S_\delta$ the set of countable intersections of sets in $S$.
\end{definition}


\begin{lemma}\label{lem:memDelta_iff_of_inter}
  \uses{def:memDelta}
  \leanok
  \lean{MeasureTheory.memDelta_iff_of_inter}
If a paving $S$ is closed under pairwise intersection, then a set $s$ is in $S_\delta$ if and only if there exists a monotone decreasing family of sets $(A_n)_{n\in\mathbb{N}}$ in $S$ such that $s = \bigcap_{n\in\mathbb{N}} A_n$.
\end{lemma}

\begin{proof}\leanok
The ``monotone decreasing'' condition is the only non-trivial part of the statement: without it it would just be the definition of $S_\delta$.
If $s \in S_\delta$ there exists a family $(B_n)$ that satisfies the condition but may not be monotone. We can then define $A_n = \bigcap_{k \le n} B_k$, and the family $(A_n)$ is monotone decreasing and satisfies $\bigcap_{n\in\mathbb{N}} A_n = \bigcap_{n\in\mathbb{N}} B_n = s$.
\end{proof}


\begin{lemma}\label{lem:memSigma_iff_of_union}
  \uses{def:memSigma}
  \leanok
  \lean{MeasureTheory.memSigma_iff_of_union}
If a paving $S$ is closed under pairwise union, then a set $s$ is in $S_\sigma$ if and only if there exists a monotone increasing family of sets $(A_n)_{n\in\mathbb{N}}$ in $S$ such that $s = \bigcup_{n\in\mathbb{N}} A_n$.
\end{lemma}

\begin{proof}\leanok
Similar to the proof of Lemma~\ref{lem:memDelta_iff_of_inter}.
\end{proof}



\begin{definition}\label{def:IsCompactSystem}
  \leanok
  \lean{IsCompactSystem}
A set of sets $K$ is a compact system if for every countable family $(C_n)_{n \in \mathbb{N}}$ of sets in $K$ such that $\bigcap_{n \in\mathbb{N}} C_n = \emptyset$, there exists a finite subset $S$ of $\mathbb{N}$ such that $\bigcap_{n \in S} C_n = \emptyset$.
\end{definition}


\begin{lemma}\label{lem:isCompactSystem_isCompact_isClosed}
  \uses{def:IsCompactSystem}
  \leanok
  \lean{isCompactSystem_isCompact_isClosed}
The family of compact closed sets of a topological space is a compact system.
\end{lemma}

\begin{proof}\leanok
  \uses{def:IsCompactSystem}

\end{proof}


\begin{lemma}\label{lem:isCompactSystem_isCompact}
  \uses{def:IsCompactSystem}
  \leanok
  \lean{isCompactSystem_isCompact}
The family of compact sets of a T2 topological space is a compact system.
\end{lemma}

\begin{proof}\leanok
  \uses{lem:isCompactSystem_isCompact_isClosed}
The T2 assumption ensures that compact sets are closed, so the family of compact sets is the family of compact closed sets, which is a compact system by Lemma~\ref{lem:isCompactSystem_isCompact_isClosed}.
\end{proof}


\begin{lemma}\label{lem:IsCompactSystem.mono}
  \uses{def:IsCompactSystem}
  \leanok
  \lean{IsCompactSystem.mono}
If $S \subseteq T$ and $T$ is a compact system, then $S$ is a compact system.
\end{lemma}

\begin{proof}\leanok
  \uses{def:IsCompactSystem}
Any sequence of sets in $S$ is a sequence of sets in $T$, so if the intersection of the sequence is empty, then there is a finite subset of the sequence whose intersection is empty by the compact system property of $T$.
\end{proof}


\begin{lemma}\label{lem:IsCompactSystem.memProd}
  \uses{def:IsCompactSystem}
  \leanok
  \lean{IsCompactSystem.memProd}
The product of two compact systems $S \times T$ is a compact system.
\end{lemma}

\begin{proof}

\end{proof}


\begin{lemma}\label{lem:IsCompactSystem.memFiniteUnion}
  \uses{def:IsCompactSystem, def:memFiniteUnion}
  \leanok
  \lean{IsCompactSystem.memFiniteUnion}
If $S$ is a compact system, then $S^{\cup f}$ is a compact system.
\end{lemma}

\begin{proof}

\end{proof}


\begin{lemma}\label{lem:IsCompactSystem.memFiniteInter}
  \uses{def:IsCompactSystem, def:memFiniteInter}
  \leanok
  \lean{IsCompactSystem.memFiniteInter}
If $S$ is a compact system, then $S^{\cap f}$ is a compact system.
\end{lemma}

TODO: $S_\delta$ is also a compact system, but we won't need that. We could prove the result for $S^{\cap f}$ by proving it for $S_\delta$ and then using the fact that $S^{\cap f} \subseteq S_\delta$ and applying Lemma~\ref{lem:IsCompactSystem.mono}.

\begin{proof}

\end{proof}


\begin{theorem}\label{thm:fst_iInter_of_memFiniteUnion_memProd_of_antitone}
  \uses{def:IsCompactSystem, def:memFiniteUnion, def:memProd}
  \leanok
  \lean{MeasureTheory.fst_iInter_of_memFiniteUnion_memProd_of_antitone}
Let $S$ be a paving of $\mathcal{X}$ and $T$ be a compact system of $\mathcal{K}$.
Let $(B_n)_{n \in \mathbb{N}}$ be a monotone decreasing sequence of sets in $(S \times T)^{\cup f}$.
Let $\pi_{\mathcal{X}} : \mathcal{X} \times \mathcal{K} \to \mathcal{X}$ be the projection on $\mathcal{X}$.
Then
\begin{align*}
  \pi_{\mathcal{X}}\left(\bigcap_{n\in\mathbb{N}} B_n\right) = \bigcap_{n\in\mathbb{N}} \pi_{\mathcal{X}}(B_n).
\end{align*}
\end{theorem}

\begin{proof}
  \uses{lem:IsCompactSystem.memFiniteUnion}

\end{proof}




\subsection{Analytic sets}

\begin{definition}[Analytic set]\label{def:IsPavingAnalytic}
  \uses{def:IsCompactSystem, def:memSigma, def:memDelta, def:memProd}
  \leanok
  \lean{MeasureTheory.IsPavingAnalytic, MeasureTheory.IsPavingAnalyticFor}
Let $F$ be a paving of a type $\mathcal{X}$.
A set $s$ of $\mathcal{X}$ is said to be $F$-analytic if there exists a nonempty type $\mathcal{K}$ and a compact system $K$ of $\mathcal{K}$ with $\emptyset \in K$ such that $s$ is the projection on $\mathcal{X}$ of a set in $(F \times K)_{\sigma \delta}$.

We denote the set of $F$-analytic sets by $\mathcal{A}(F)$.
\end{definition}

Lean note: we can't quantify over universes, so we have to restrict $\mathcal{K}$ to \texttt{Type}. We have an auxiliary definition \texttt{IsPavingAnalyticFor} that specifies which $\mathcal{K}$ is used.


\begin{lemma}\label{lem:isPavingAnalytic_of_prop}
  \uses{def:IsPavingAnalytic}
  \leanok
  \lean{MeasureTheory.isPavingAnalytic_of_prop}
Every set in $F$ is $F$-analytic: $F \subseteq \mathcal{A}(F)$.
\end{lemma}

\begin{proof}\leanok

\end{proof}


\begin{lemma}\label{lem:IsPavingAnalytic.mono}
  \uses{def:IsPavingAnalytic}
  \leanok
  \lean{MeasureTheory.IsPavingAnalytic.mono}
If $F \subseteq G$ and $s$ is $F$-analytic, then $s$ is $G$-analytic: $\mathcal{A}(F) \subseteq \mathcal{A}(G)$.
\end{lemma}

\begin{proof}\leanok

\end{proof}


\begin{lemma}\label{lem:IsPavingAnalytic.exists_memSigma_superset}
  \uses{def:IsPavingAnalytic}
  \leanok
  \lean{MeasureTheory.IsPavingAnalyticFor.exists_memSigma_superset}
If $s$ is $F$-analytic, then there exists a set $t$ in $F_\sigma$ such that $s \subseteq t$.
\end{lemma}

\begin{proof}\leanok

\end{proof}


\begin{lemma}\label{lem:IsPavingAnalytic.iUnion}
  \uses{def:IsPavingAnalytic}
  \leanok
  \lean{MeasureTheory.IsPavingAnalytic.iUnion, MeasureTheory.IsPavingAnalytic.union}
A countable union of $F$-analytic sets is $F$-analytic.
\end{lemma}

\begin{proof}

\end{proof}


\begin{lemma}\label{lem:IsPavingAnalytic.iInter}
  \uses{def:IsPavingAnalytic}
  \leanok
  \lean{MeasureTheory.IsPavingAnalytic.iInter, MeasureTheory.IsPavingAnalytic.inter}
A countable intersection of $F$-analytic sets is $F$-analytic.
\end{lemma}

\begin{proof}

\end{proof}


\begin{lemma}\label{lem:IsPavingAnalytic.fst}
  \uses{def:IsPavingAnalytic, def:IsCompactSystem}
  \leanok
  \lean{MeasureTheory.IsPavingAnalytic.fst}
Let $F$ be a set of sets of $\mathcal{X}$ and $K$ be a compact system of $\mathcal{K}$, with $\emptyset \in K$.
If a set $s$ of $\mathcal{X} \times \mathcal{K}$ is $F \times K$-analytic, then its projection on $\mathcal{X}$ is $F$-analytic.
\end{lemma}

\begin{proof}\leanok
  \uses{lem:IsCompactSystem.memProd}

\end{proof}


\begin{lemma}\label{lem:IsPavingAnalytic.prod_left}
  \uses{def:IsPavingAnalytic}
  \leanok
  \lean{MeasureTheory.IsPavingAnalytic.prod_left}
If $t \in T$ and $s$ is $F$-analytic, then $t \times s$ is $(T \times F)$-analytic: $T \times \mathcal{A}(F) \subseteq \mathcal{A}(T \times F)$.
\end{lemma}

\begin{proof}\leanok

\end{proof}


\begin{lemma}\label{lem:IsPavingAnalytic.prod}
  \uses{def:IsPavingAnalytic}
  \leanok
  \lean{MeasureTheory.IsPavingAnalytic.prod}
If $s$ is $F$-analytic and $t$ is $G$-analytic, then $s \times t$ is $(F \times G)$-analytic: $\mathcal{A}(F) \times \mathcal{A}(G) \subseteq \mathcal{A}(F \times G)$.
\end{lemma}

\begin{proof}\leanok
  \uses{lem:IsPavingAnalytic.prod_left, lem:IsPavingAnalytic.exists_memSigma_superset}

\end{proof}


\begin{lemma}\label{lem:isPavingAnalytic_isPavingAnalytic}
  \uses{def:IsPavingAnalytic}
  \leanok
  \lean{MeasureTheory.isPavingAnalytic_isPavingAnalytic}
$\mathcal{A}(\mathcal{A}(F)) = \mathcal{A}(F)$.
\end{lemma}

\begin{proof}\leanok
  \uses{lem:IsPavingAnalytic.iInter, lem:IsPavingAnalytic.iUnion, lem:IsPavingAnalytic.prod, lem:IsPavingAnalytic.fst}

\end{proof}



\subsection{Analytic sets in measurable spaces}

We denote by $K_{\mathbb{R}}$ the paving of compact sets of $\mathbb{R}$.
For a measurable space $\mathcal{X}$, we denote by $M_{\mathcal{X}}$ the paving of measurable sets of $\mathcal{X}$.

\begin{lemma}\label{lem:isPavingAnalytic_of_measurableSet_generateFrom}
  \uses{def:IsPavingAnalytic}
  \leanok
  \lean{MeasureTheory.isPavingAnalytic_of_measurableSet_generateFrom}
Let $F$ be a paving with $\emptyset \in F$ and let $\sigma(F)$ be the $\sigma$-algebra generated by $F$.
Suppose that for every $t \in F$, $t^c$ is $F$-analytic.
Then every set in $\sigma(F)$ is $F$-analytic: $\sigma(F) \subseteq \mathcal{A}(F)$.
\end{lemma}

\begin{proof}\leanok
  \uses{lem:isPavingAnalytic_of_prop, lem:IsPavingAnalytic.iUnion, lem:IsPavingAnalytic.iInter}

\end{proof}


\begin{lemma}\label{lem:MeasurableSet.isPavingAnalytic_isCompact_real}
  \uses{def:IsPavingAnalytic}
  \leanok
  \lean{MeasurableSet.isPavingAnalytic_isCompact_real}
A measurable set of $\mathbb{R}$ is $K_{\mathbb{R}}$-analytic.
That is, $M_{\mathbb{R}} \subseteq \mathcal{A}(K_{\mathbb{R}})$.
\end{lemma}

\begin{proof}
  \uses{lem:isPavingAnalytic_of_measurableSet_generateFrom, lem:IsPavingAnalytic.iUnion, lem:isPavingAnalytic_of_prop}

\end{proof}


\begin{lemma}\label{lem:IsPavingAnalytic_measurableSet_iff_isPavingAnalytic_compact}
  \uses{def:IsPavingAnalytic}
  \leanok
  \lean{MeasureTheory.IsPavingAnalytic_measurableSet_iff_isPavingAnalytic_compact}
A set of $\mathbb{R}$ is $M_{\mathbb{R}}$-analytic if and only if it is $K_{\mathbb{R}}$-analytic.
\end{lemma}

\begin{proof}\leanok
  \uses{lem:isPavingAnalytic_isPavingAnalytic, lem:MeasurableSet.isPavingAnalytic_isCompact_real}

\end{proof}


\begin{lemma}\label{lem:MeasurableSet.isPavingAnalytic_memProd}
  \uses{def:IsPavingAnalytic}
  \leanok
  \lean{MeasurableSet.isPavingAnalytic_memProd}
Let $\mathcal{X}$ be a measurable space and $s$ be a measurable set of $\mathcal{X} \times \mathbb{R}$.
Then $s$ is $(M_{\mathcal{X}} \times K_{\mathbb{R}})$-analytic.
\end{lemma}

\begin{proof}\leanok
  \uses{lem:isPavingAnalytic_of_measurableSet_generateFrom, lem:IsPavingAnalytic.iUnion, lem:isPavingAnalytic_of_prop}

\end{proof}


\begin{lemma}\label{lem:isPavingAnalytic_fst_of_memProd_measurableSet_isCompact}
  \uses{def:IsPavingAnalytic}
  \leanok
  \lean{MeasureTheory.isPavingAnalytic_fst_of_memProd_measurableSet_isCompact}
Let $\mathcal{X}$ be a measurable space and $s$ be a set of $\mathcal{X} \times \mathbb{R}$ which is $(M_{\mathcal{X}} \times K_{\mathbb{R}})$-analytic.
Then the projection $\pi_{\mathcal{X}}(s)$ is $M_{\mathcal{X}}$-analytic.
\end{lemma}

\begin{proof}\leanok
  \uses{lem:IsPavingAnalytic.fst}

\end{proof}


\begin{lemma}\label{lem:MeasurableSet.isPavingAnalytic_fst}
  \uses{def:IsPavingAnalytic}
  \leanok
  \lean{MeasurableSet.isPavingAnalytic_fst}
Let $\mathcal{X}$ be a measurable space and $s$ be a measurable set of $\mathcal{X} \times \mathbb{R}$.
Then the projection of $s$ on $\mathcal{X}$ is $M_{\mathcal{X}}$-analytic.
\end{lemma}

\begin{proof}\leanok
  \uses{lem:MeasurableSet.isPavingAnalytic_memProd, lem:isPavingAnalytic_fst_of_memProd_measurableSet_isCompact}

\end{proof}


\begin{definition}\label{def:IsMeasurableAnalytic}
  \leanok
  \lean{MeasureTheory.IsMeasurableAnalytic, MeasureTheory.IsMeasurableAnalyticFor}
We say that a set $s$ of a measurable space $\mathcal{X}$ is measurably analytic for a measurable space $\mathcal{K}$ if it is the projection of a measurable set of $\mathcal{X} \times \mathcal{K}$.

We say that $s$ is measurably analytic if it is measurably analytic for $\mathbb{R}$.
\end{definition}


\begin{lemma}\label{lem:IsMeasurableAnalyticFor.isMeasurableAnalytic}
  \uses{def:IsMeasurableAnalytic}
  \leanok
  \lean{MeasureTheory.IsMeasurableAnalyticFor.isMeasurableAnalytic}
Let $\mathcal{K}$ be a standard Borel space.
If a set $s$ of $\mathcal{X}$ is measurably analytic for $\mathcal{K}$, then it is measurably analytic.
\end{lemma}

\begin{proof}\leanok
There is a measurable embedding of $\mathcal{K}$ into $\mathbb{R}$.
\end{proof}


\begin{lemma}\label{lem:IsMeasurableAnalytic.isPavingAnalytic}
  \uses{def:IsMeasurableAnalytic, def:IsPavingAnalytic}
  \leanok
  \lean{MeasureTheory.IsMeasurableAnalytic.isPavingAnalytic}
If a set $s$ of $\mathcal{X}$ is measurably analytic, then it is $M_{\mathcal{X}}$-analytic.
\end{lemma}

\begin{proof}\leanok
  \uses{lem:MeasurableSet.isPavingAnalytic_fst}

\end{proof}



\subsection{Capacities and capacitable sets}

\begin{definition}\label{def:Capacity}
  \leanok
  \lean{MeasureTheory.Capacity}
Let $F$ be a set of sets of a type $\mathcal{X}$.
An $F$-capacity is a function $I$ from the sets of $\mathcal{X}$ to $\mathbb{R}_{+,\infty}$ such that
\begin{enumerate}
  \item $I$ is monotone for set inclusion: for $s \subseteq t$, $I(s) \le I(t)$,
  \item if $(s_n)_{n\in\mathbb{N}}$ is an increasing sequence of sets of $\mathcal{X}$, then $I(s_n)$ tends to $I(\bigcup_{n\in\mathbb{N}} s_n)$ at infinity,
  \item if $(s_n)_{n\in\mathbb{N}}$ is a decreasing sequence of sets in $F$, then $I(s_n)$ tends to $I(\bigcap_{n\in\mathbb{N}} s_n)$ at infinity.
\end{enumerate}
\end{definition}


\begin{lemma}\label{lem:Capacity.comp_fst_aux}
  \uses{def:Capacity, def:IsCompactSystem}
  \leanok
  \lean{MeasureTheory.Capacity.comp_fst}
Let $F$ be a set of sets of $\mathcal{X}$ and let $I$ be an $F$-capacity.
Suppose that $\emptyset \in F$ and $F$ is closed under pairwise unions.
Let $K$ be a compact system of $\mathcal{K}$.
Let $\pi_{\mathcal{X}} : \mathcal{X} \times \mathcal{K} \to \mathcal{X}$ be the projection on the first coordinate.
Then the function $I_{\mathcal{X}}(u) = I(\pi_{\mathcal{X}}(u))$ is a capacity for $(F \times K)^{\cup f}$.
\end{lemma}

\begin{proof}\leanok
  \uses{thm:fst_iInter_of_memFiniteUnion_memProd_of_antitone}

\end{proof}


\begin{definition}\label{def:Capacity.comp_fst}
  \uses{def:Capacity, def:IsCompactSystem}
  \leanok
  \lean{MeasureTheory.Capacity.comp_fst}
Let $F$ be a set of sets of $\mathcal{X}$ and let $I$ be an $F$-capacity.
Suppose that $\emptyset \in F$ and $F$ is closed under pairwise unions.
Let $K$ be a compact system of $\mathcal{K}$.
Let $\pi_{\mathcal{X}} : \mathcal{X} \times \mathcal{K} \to \mathcal{X}$ be the projection on the first coordinate.
Then we define a capacity for $(F \times K)^{\cup f}$ by $I_{\mathcal{X}}(u) = I(\pi_{\mathcal{X}}(u))$ (it is indeed a capacity by Lemma~\ref{lem:Capacity.comp_fst_aux}).
\end{definition}


\begin{definition}\label{def:IsCapacitable}
  \uses{def:Capacity}
  \leanok
  \lean{MeasureTheory.IsCapacitable}
Let $F$ be a set of sets of $\mathcal{X}$ and let $I$ be an $F$-capacity.
A set $s$ of $\mathcal{X}$ is said to be $I$-capacitable if for all $a < I(s)$, there exists a set $t \in F_\delta$ such that $t \subseteq s$ and $a \le I(t)$.
\end{definition}


\begin{lemma}\label{lem:isCapacitable_of_prop}
  \uses{def:IsCapacitable}
  \leanok
  \lean{MeasureTheory.isCapacitable_of_prop}
For $I$ an $F$-capacity, every set in $F$ is $I$-capacitable.
\end{lemma}

\begin{proof}\leanok

\end{proof}


\begin{lemma}\label{lem:isCapacitable_memDelta_memSigma}
  \uses{def:IsCapacitable, def:Capacity, def:memDelta, def:memSigma}
  \leanok
  \lean{MeasureTheory.isCapacitable_memDelta_memSigma}
Suppose that $F$ contains the empty set and is closed under pairwise intersections and unions, and let $I$ be an $F$-capacity.
Then every set of $F_{\sigma \delta}$ is $I$-capacitable.
\end{lemma}

\begin{proof}
  \uses{lem:memSigma_iff_of_union}

\end{proof}


\begin{lemma}\label{lem:memDelta_fst}
  \uses{def:memDelta, def:memProd, def:IsCompactSystem}
  \leanok
  \lean{MeasureTheory.memDelta_fst}
Suppose that $F$ contains the empty set and is closed under pairwise intersections and unions, and let $I$ be an $F$-capacity.
Let $K$ be a compact system which is also closed under pairwise intersections.
Let $s \in ((F \times K)^{\cup f})_\delta$.
Then $\pi_{\mathcal{X}}(s) \in F_\delta$.
\end{lemma}

\begin{proof}\leanok
  \uses{thm:fst_iInter_of_memFiniteUnion_memProd_of_antitone, lem:memDelta_iff_of_inter}

\end{proof}


\begin{lemma}\label{lem:IsCapacitable.fst}
  \uses{def:IsCapacitable, def:Capacity, def:Capacity.comp_fst, def:IsCompactSystem}
  \leanok
  \lean{MeasureTheory.IsCapacitable.fst}
Let $F$ be a set of sets of $\mathcal{X}$ and let $I$ be an $F$-capacity.
Suppose that $F$ contains the empty set and is closed under pairwise intersections and unions.
Let $K$ be a compact system of $\mathcal{K}$ which is also closed under pairwise intersections.
If a set $s$ of $\mathcal{X} \times \mathcal{K}$ is capacitable with respect to the capacity $I_{\mathcal{X}}$ of Definition~\ref{def:Capacity.comp_fst}, then its projection on $\mathcal{X}$ is capacitable with respect to $I$.
\end{lemma}

\begin{proof}\leanok
  \uses{lem:memDelta_fst}

\end{proof}


\begin{theorem}[Choquet's capacitability theorem]\label{thm:IsPavingAnalytic.isCapacitable}
  \uses{def:IsPavingAnalytic, def:IsCapacitable}
  \leanok
  \lean{MeasureTheory.IsPavingAnalytic.isCapacitable}
Let $F$ be a set of sets of $\mathcal{X}$ and let $I$ be an $F$-capacity.
Suppose that $F$ contains the empty set and is closed under pairwise intersections and unions.
Then every $F$-analytic set is $I$-capacitable.
\end{theorem}

\begin{proof}\leanok
  \uses{lem:isCapacitable_memDelta_memSigma, lem:IsCompactSystem.memFiniteInter, lem:IsCapacitable.fst}

\end{proof}



\subsection{Capacities and measures}


\begin{definition}\label{def:Measure.capacity}
  \uses{def:Capacity}
  \leanok
  \lean{MeasureTheory.Measure.capacity}
Every finite measure defines a capacity by $I(s) = \mu(s)$ (where $\mu(s)$ is the value of the outer measure defined by $\mu$, but in Lean that's how $\mu(s)$ is defined already).
\end{definition}


\begin{lemma}\label{lem:isCapacitable_measure_iff}
  \uses{def:IsCapacitable, def:Measure.capacity}
  \leanok
  \lean{MeasureTheory.isCapacitable_measure_iff}
A set is capacitable with respect to the capacity defined by a finite measure if and only if it is null-measurable for this measure.
\end{lemma}

\begin{proof}

\end{proof}


\begin{lemma}\label{lem:IsPavingAnalytic.nullMeasurableSet}
  \uses{def:IsPavingAnalytic}
  \leanok
  \lean{MeasureTheory.IsPavingAnalytic.nullMeasurableSet}
An $M_{\mathcal{X}}$-analytic set of a measurable space $\mathcal{X}$ is universally measurable: it is null-measurable for every finite measure on $\mathcal{X}$.
\end{lemma}

\begin{proof}\leanok
  \uses{thm:IsPavingAnalytic.isCapacitable, def:Measure.capacity, lem:isCapacitable_measure_iff}

\end{proof}


\begin{lemma}\label{lem:IsMeasurableAnalytic.nullMeasurableSet}
  \uses{def:IsMeasurableAnalytic}
  \leanok
  \lean{MeasureTheory.IsMeasurableAnalytic.nullMeasurableSet}
A measurably analytic set of a measurable space $\mathcal{X}$ is universally measurable: it is null-measurable for every finite measure on $\mathcal{X}$.
\end{lemma}

\begin{proof}\leanok
  \uses{lem:IsMeasurableAnalytic.isPavingAnalytic, lem:IsPavingAnalytic.nullMeasurableSet}

\end{proof}


\begin{theorem}[Measurable projection]\label{thm:MeasurableSet.nullMeasurableSet_fst}
  \uses{def:IsMeasurableAnalytic}
  \leanok
  \lean{MeasurableSet.nullMeasurableSet_fst}
Let $\mathcal{X}$ and $\mathcal{Y}$ be measurable spaces, with $\mathcal{Y}$ standard Borel.
Then the projection of a measurable set of $\mathcal{X} \times \mathcal{Y}$ on $\mathcal{X}$ is universally measurable.
\end{theorem}

\begin{proof}\leanok
  \uses{lem:IsMeasurableAnalyticFor.isMeasurableAnalytic, lem:IsMeasurableAnalytic.nullMeasurableSet}

\end{proof}




\section{Monotone class theorem}


\begin{definition}[Monotone class]\label{def:monotone_class}
  \leanok
  \lean{MeasureTheory.MonotoneClass}
Let $\mathcal{M}$ be a collection of subsets of a set $X$. We say that $\mathcal{M}$ is a monotone class if it is closed under countable monotone unions and countable monotone intersections, i.e.:
\begin{enumerate}
  \item if \( A_1, A_2, \ldots \in M \) and \( A_1 \subseteq A_2 \subseteq \cdots \), then
  \( \bigcup_{i=1}^\infty A_i \in M \),
  \item if \( B_1, B_2, \ldots \in M \) and \( B_1 \supseteq B_2 \supseteq \cdots \), then
  \( \bigcap_{i=1}^\infty B_i \in M \).
\end{enumerate}
Given a collection $\mathcal{F}$ of subsets of $X$, we call the smallest monotone class containing $\mathcal{F}$ the monotone class generated by $\mathcal{F}$.
\end{definition}


\begin{theorem}[Monotone class theorem]\label{thm:monotone_class}
  \uses{def:monotone_class}
  \leanok
  \lean{MeasureTheory.MonotoneClass.generateFrom_eq}
Let \(G\) be an algebra of subsets of a set \(X\). Then the monotone class generated by \(G\) coincides with the $\sigma$-algebra generated by \(G\).
\end{theorem}

\begin{proof}\leanok

\end{proof}




\section{Debut Theorem}

TODO: if we go for the approach above, we don't need the development below.

The following proof is based on "R.F. Bass, The measurability of hitting times, Electron. Commun. Probab. {\bf 15} (2010), 99--105; MR2606507"
and the successive "R.F. Bass. "Correction to "The measurability of hitting times"." Electron. Commun. Probab. 16 189 - 191, 2011. \url{https://doi.org/10.1214/ECP.v16-1627}" \cite{bass2010measurability}
which is a rather clever and short proof evading the classical proof which uses more complex structures. Note that there exists also an Arxiv version of the paper with the corrections applied (\url{https://arxiv.org/pdf/1001.3619}), we will mostly reference this unified version.


Standard notation in this chapter:
$(\Omega, \mathcal{F} , P)$ is a probability space;
$\mathcal{S}$ is a topological space;
$\pi:\mathbb{R}_{\geq 0}\times\Omega\rightarrow \Omega$ is the projection; $P^*$ is the outer measure associated with $P$.


\begin{definition}[Progressively measurable set]\label{def:progr_meas_set}
  \leanok
  \uses{def:ProgMeasurable}
  \lean{MeasureTheory.ProgMeasurableSet}
A subset of $[0, \infty) \times \Omega$ is progressively measurable if its indicator is a progressively measurable process.
\end{definition}


\begin{definition}[Debut of a set]\label{def:debut_set}
  \leanok
  \lean{MeasureTheory.debut}
Let $E \subseteq{} [0, \infty) \times \Omega $, define $D_E = \inf\left\lbrace t \geq 0\ :\ (t, \omega) \in E\right\rbrace$, the debut of $E$.
\end{definition}


\begin{definition}[$\mathcal{K}^0$]\label{def:subsets_compact_RNN_times_measurable}
  \leanok
  \lean{MeasureTheory.ùìö‚ÇÄ}
Let $t>0$. Let $\mathcal{K}^0(t)$ be the collection of subsets of $[0, t] \times \Omega$ of the form $K \times C$, where $K$ is a compact subset of $[0, t]$ and $C \in \mathcal{F}_t$.
\end{definition}


\begin{definition}[$\mathcal{K}$]\label{def:fin_union_RNN_times_measurable}
  \leanok
  \lean{MeasureTheory.ùìö}
  \uses{def:subsets_compact_RNN_times_measurable}
Let $t>0$. Let $\mathcal{K}(t)$ be the collection of finite unions of elements of $\mathcal{K}^0(t)$.
\end{definition}


\begin{definition}[$\mathcal{K}_\delta$]\label{def:count_inter_of_fin_union_RNN_times_measurable}
  \leanok
  \lean{MeasureTheory.ùìöŒ¥}
  \uses{def:fin_union_RNN_times_measurable}
Let $t>0$. Let $\mathcal{K}_\delta(t)$ be the collection of countable intersections of elements of $\mathcal{K}(t)$.
\end{definition}


\begin{definition}[$t$-approximable set]\label{def:t_approx_set}
  \leanok
  \lean{MeasureTheory.Approximation}
  \uses{def:count_inter_of_fin_union_RNN_times_measurable}
Let $t>0$.
We say $A \in \mathcal{B}[0, t] \times \mathcal{F}_t$ is
$t$-approximable if given $\epsilon > 0$, there exists $B \in \mathcal{K}_\delta (t)$ with $B \subseteq{} A$ and
$$P^‚àó (\pi(A)) \leq P^‚àó (\pi(B)) + \epsilon,$$
where $\pi$ is the projection over $\Omega$.
\end{definition}


\begin{lemma}\label{lem:K0_basic}
  \leanok
  \lean{MeasureTheory.empty_mem_ùìö‚ÇÄ, MeasureTheory.inter_mem_ùìö‚ÇÄ, MeasureTheory.subset_Iic_of_mem_ùìö‚ÇÄ}
  \uses{def:subsets_compact_RNN_times_measurable}
$\mathcal{K}^0(t)$ contains the empty set and is closed under finite intersections.
Any set in $\mathcal{K}^0(t)$ is a subset of $[0, t] \times \Omega$.
\end{lemma}

\begin{proof}\leanok
  \uses{def:subsets_compact_RNN_times_measurable}

\end{proof}


\begin{lemma}\label{lem:K0_measurableSet_snd}
  \leanok
  \lean{MeasureTheory.measurableSet_snd_of_mem_ùìö‚ÇÄ}
  \uses{def:subsets_compact_RNN_times_measurable}
For $B \in \mathcal{K}^0(t)$, $\pi(B)$ is $\mathcal{F}_t$-measurable.
\end{lemma}

\begin{proof}\leanok
  \uses{def:subsets_compact_RNN_times_measurable}

\end{proof}


\begin{lemma}\label{lem:K_basic}
  \leanok
  \lean{MeasureTheory.empty_mem_ùìö, MeasureTheory.inter_mem_ùìö, MeasureTheory.union_mem_ùìö, MeasureTheory.subset_Iic_of_mem_ùìö, MeasureTheory.ùìö‚ÇÄ_subset_ùìö}
  \uses{def:fin_union_RNN_times_measurable}
$\mathcal{K}(t)$ contains the empty set and is closed under finite intersections and finite unions.
Any set in $\mathcal{K}(t)$ is a subset of $[0, t] \times \Omega$.
$\mathcal{K}^0(t)$ is a subset of $\mathcal{K}(t)$.
\end{lemma}

\begin{proof}\leanok
  \uses{def:fin_union_RNN_times_measurable, lem:K0_basic}

\end{proof}


\begin{lemma}\label{lem:K_measurableSet_snd}
  \leanok
  \lean{MeasureTheory.measurableSet_snd_of_mem_ùìö}
  \uses{def:fin_union_RNN_times_measurable}
For $B \in \mathcal{K}(t)$, $\pi(B)$ is $\mathcal{F}_t$-measurable.
\end{lemma}

\begin{proof}\leanok
  \uses{def:fin_union_RNN_times_measurable}
\end{proof}


\begin{lemma}\label{lem:Kdelta_basic}
  \leanok
  \lean{MeasureTheory.empty_mem_ùìöŒ¥, MeasureTheory.union_mem_ùìöŒ¥, MeasureTheory.inter_mem_ùìöŒ¥, MeasureTheory.iInter_mem_ùìöŒ¥, MeasureTheory.subset_Iic_of_mem_ùìöŒ¥, MeasureTheory.ùìö_subset_ùìöŒ¥}
  \uses{def:count_inter_of_fin_union_RNN_times_measurable}
$\mathcal{K}_\delta(t)$ contains the empty set and is closed under finite unions and countable intersections.
Any set in $\mathcal{K}_\delta(t)$ is a subset of $[0, t] \times \Omega$.
$\mathcal{K}(t)$ is a subset of $\mathcal{K}_\delta(t)$.
\end{lemma}

\begin{proof}
  \uses{def:count_inter_of_fin_union_RNN_times_measurable, lem:K_basic}

\end{proof}


\begin{lemma}\label{lem:iInf_snd_eq_snd_iInf}
  \leanok
  \lean{MeasureTheory.iInf_snd_eq_snd_iInf_of_mem_ùìöŒ¥}
  \uses{def:count_inter_of_fin_union_RNN_times_measurable}
If $B \in \mathcal{K}_\delta (t)$, $\forall n\in \mathbb{N}$, $B_n \in \mathcal{K}_\delta(t)$ and $B_n \searrow B$, then $\pi(B) = \bigcap_{n\in\mathbb{N}} \pi(B_n)$.
\end{lemma}

\begin{proof}
  % See the proof of Lemma 2.2 in the corrected paper.

  For each $\omega \in \Omega$ and each set $C \subseteq [0,+\infty) \times \Omega$, let
  \[S(C)(\omega) = \{s \leq t : (s,\omega) \in C\}.\]

  If $B \in \mathcal{K}_\delta(t)$, then $S(B)(\omega)$
  is compact. In fact, there exists a sequence $A_n \in \mathcal{K}(t)$ such that
  $A_n \searrow B$, therefore $S(A_n)(\omega)$ is compact and $S(A_n)(\omega) \searrow S(B)(\omega)$. In particular, $S(B_n)(\omega)$ is compact for each $n$.

  Now we divide the proof in two cases.

  One possibility is that
  $\bigcap_{n \in \mathbb{N}} S(B_n)(\omega) \neq \emptyset$; in this case, if $s \in \bigcap_{n \in \mathbb{N}} S(B_n)(\omega)$,
  then $(s,\omega) \in B_n$ for each $n$, and so $(s,\omega) \in B$. Therefore,
  $\omega \in \pi(B_n)$ for each $n$ and $\omega \in \pi(B)$.

  The other possibility is that $\bigcap_{n \in \mathbb{N}} S(B_n)(\omega) = \emptyset$.
  Since the sequence $S(B_n)(\omega)$ is a decreasing sequence of compact sets,
    $S(B_n)(\omega) = \emptyset$ for some $n$,
  for otherwise $\bigcap_{n \in \mathbb{N}} S(B_n)(\omega)$ would also be nonempty.
  Therefore $\omega \notin \pi(B_n)$ and $\omega \notin \pi(B)$.

  We conclude that $\omega \in \pi(B)$ if and only if $\omega \in \bigcap_{n \in \mathbb{N}} \pi(B_n)$, hence $\pi(B) = \bigcap_{n \in \mathbb{N}} \pi(B_n)$.
\end{proof}


\begin{lemma}\label{lem:K_delta_of_inter_K_delta}
  \leanok
  \lean{MeasureTheory.measurableSet_snd_of_mem_ùìöŒ¥}
  \uses{def:count_inter_of_fin_union_RNN_times_measurable}
If $B \in \mathcal{K}_\delta (t)$, then $\pi(B) \in \mathcal{F}_t$.
\end{lemma}

\begin{proof}
  \leanok
  \uses{lem:iInf_snd_eq_snd_iInf}
% See the proof of Lemma 2.2 in the corrected paper.
By definition of $\mathcal{K}_\delta(t)$, $B = \bigcap_{n\in\mathbb{N}} B_n$ where $B_n \in \mathcal{K}(t)$.
Therefore, by Lemma~\ref{lem:iInf_snd_eq_snd_iInf}, \[\pi(B) = \pi \left(\bigcap_{n\in\mathbb{N}} B_n\right) = \bigcap_{n\in\mathbb{N}} \pi(B_n) \in \mathcal{F}_t .\]
\end{proof}


\begin{lemma}\label{lem:measurable_of_t_approx}
  \leanok
  \lean{MeasureTheory.Approximation.measurableSet_snd}
  \uses{def:t_approx_set}
  If $A$ is $t$-approximable, then $\pi(A) \in \mathcal{F}_t$.
\end{lemma}

\begin{proof}
  \uses{lem:K_delta_of_inter_K_delta}
  % See the proof of Lemma 2.3 in the corrected paper.
  Choose $A_n \in \mathcal{K}_\delta(t)$ with $A_n \subseteq A$ and
  $P(\pi(A_n)) \to P^*(\pi(A))$. Let $B_n = A_1 \cup \cdots \cup A_n$ and
  let $B = \bigcup_{n \in \mathbb{N}} B_n$. Then
  $B_n \in \mathcal{K}_\delta(t)$, $B_n \nearrow B$, and $P(\pi(B_n)) \geq P(\pi(A_n)) \to
  P^*(\pi(A))$.
  Moreover, by Lemma~\ref{lem:K_delta_of_inter_K_delta}, $\pi(B_n) \in \mathcal{F}_t$.
  It follows that $\pi(B_n) \nearrow \pi(B)$, and so $\pi(B) \in \mathcal{F}_t$ and
  $$P(\pi(B)) = \lim_{n \to \infty} P(\pi(B_n)) = P^*(\pi(A)).$$

  For each $n$, there exists $C_n \in \mathcal{F}$ such that
  $\pi(A) \subseteq C_n$ and $P(C_n) \leq P^*(\pi(A)) + 1/n$. Setting
  $C = \bigcap_{n \in \mathbb{N}} C_n$, we have $\pi(A) \subseteq C$ and $P^*(\pi(A)) = P(C)$.
  Therefore
  $\pi(B) \subseteq \pi(A) \subseteq C$ and $P(\pi(B)) = P^*(\pi(A)) = P(C)$.
  This implies that $\pi(A) \setminus \pi(B)$ is a $P$-null set, and by
  the completeness assumption, $\pi(A) = (\pi(A) \setminus \pi(B)) \cup \pi(B) \in \mathcal{F}_t$.
\end{proof}


\begin{lemma}\label{lem:exists_B_of_t_approx}
  \leanok
  \lean{MeasureTheory.Approximation.tendsto_measure_diff_B'}
  \uses{def:count_inter_of_fin_union_RNN_times_measurable, def:t_approx_set}
  Suppose $A$ is $t$-approximable. Then, given $\epsilon > 0$, there exists
  $B \in \mathcal{K}_\delta (t)$ such that $P(\pi(A) \setminus \pi(B)) < \epsilon$.
\end{lemma}

\begin{proof}
  \uses{lem:K_delta_of_inter_K_delta}
  % See the proof of Lemma 2.3 in the corrected paper.
  Let $B_n$ and $B$ be as in the proof of Lemma~\ref{lem:measurable_of_t_approx}.
  Then,
  $$\lim_{n \to \infty} P(\pi(A) \setminus \pi(B_n)) = P(\pi(A) \setminus \pi(B)) = 0.$$
\end{proof}


% consider removing this lemma altogether, I think we do not even need it in the proof
\begin{lemma}\label{lem:aux1a}
  \mathlibok
  \lean{MeasureTheory.exists_measurable_superset}
If $A \subseteq \Omega$, there exists $C \in \mathcal{F}$ such that $A \subseteq C$ and $P^‚àó(A) = P(C)$.
\end{lemma}

\begin{proof}\leanok

\end{proof}


\begin{lemma}\label{lem:aux1b}
  \mathlibok
  \lean{Monotone.measure_iUnion}
  % this is a version with the sup, if needed there is also the version with the limit
Let $(A_n)_{n\in\mathbb{N}},A\subseteq \Omega$.
Suppose $A_n \nearrow A$. Then $P^‚àó(A) = \lim_{n\rightarrow \infty} P^‚àó(A_n)$.
\end{lemma}

\begin{proof}\leanok

\end{proof}


\begin{definition}[$\mathcal{L}$-sets]\label{def:L_sets}
  \leanok
  \lean{MeasureTheory.ùìõ‚ÇÄ, MeasureTheory.ùìõ‚ÇÅ, MeasureTheory.ùìõ, MeasureTheory.ùìõœÉ, MeasureTheory.ùìõœÉŒ¥}
  \uses{def:count_inter_of_fin_union_RNN_times_measurable}
  From hereafter the following sets are needed:

  \begin{itemize}
  \item $\mathcal{L}_0(X) := \left\lbrace A \times B\ :\ A \subseteq X ,\ A \text{ compact},\ B \in \mathcal{K}(t)\right\rbrace$
  \item $\mathcal{L}_1(X )$ the class of finite unions of sets in $\mathcal{L}_0(X )$
  \item $\mathcal{L} (X )$ the class of intersections of countable decreasing sequences in $\mathcal{L}_1(X )$
  \item $\mathcal{L}_\sigma(X )$ be the class of unions of countable increasing sequences of sets in $\mathcal{L} (X )$
  \item $\mathcal{L}_{\sigma\delta}(X )$ the class of intersections of countable decreasing sequences of sets in $\mathcal{L}_\sigma(X )$
  \end{itemize}
\end{definition}


\begin{lemma}\label{lem:exists_cpct_Hausdorff}
  \leanok
  \lean{MeasureTheory.exists_mem_ùìõœÉŒ¥_of_measurableSet}
  \uses{def:L_sets}
If $A \in \mathcal{B}[0, t] \times \mathcal{F}_t$, there exists a compact Hausdorff space $X$ and $B \in \mathcal{L}_{\sigma\delta}(X )$ such  that $A = \rho^X (B)$.

Where $\rho^X:X\times ([0,t]\times\Omega)\rightarrow [0,t]\times\Omega$ is the projection.
\end{lemma}

\begin{proof}
  \uses{thm:monotone_class}
  % See Lemma 2.5 in the corrected paper.
  %TODO: this proof needs to be expanded in multiple lemmas, for now I just copy pasted it from the paper, but probably we will need to separately define the set M, prove as a lemma that it is a monotone class, etc. We will also need to find the monotone class theorem or prove it ourselves, in the latter case I think we will need to have a section dedicated to it.

  TODO: Reorganize this proof, possibly divide it in multiple lemmas.

  If $A \in \mathcal{K}(t)$, we take $X = [0,1]$, the unit interval with the
  usual topology and $B = X \times A$. Thus the collection $\mathcal{M}$ of
  subsets of $\mathcal{B}[0,t] \times \mathcal{F}_t$
  for which the lemma is satisfied contains $\mathcal{K}(t)$. We will
  show that $\mathcal{M}$ is a monotone class.


  Suppose $A_n \in \mathcal{M}$ with $A_n \downarrow A$. There exist compact Hausdorff
  spaces $X_n$ and sets $B_n \in \mathcal{L}_{\sigma\delta}(X_n)$ such that $A_n = \rho^{X_n}(B_n)$.
  Let $X = \prod_{n=1}^\infty X_n$ be furnished with the product topology. Let
  $\tau_n: X \times [0,t] \times \Omega \to X_n \times [0,t] \times \Omega$ be defined by $\tau_n(x,(s,\omega))
  = (x_n,(s,\omega))$ if $x = (x_1,x_2, \ldots)$. Let $C_n = \tau_n^{-1}(B_n)$
  and let $C = \bigcap_{n \in \mathbb{N}} C_n$. It is easy to check that $\mathcal{L}(X)$ is closed under
  the operations of finite unions and intersections, from which it follows
  that $C \in \mathcal{L}_{\sigma\delta}(X)$. If $(s,\omega) \in A$, then for each $n$ there exists $x_n \in X_n$ such that $(x_n,(s,\omega)) \in B_n$. Note that
  $((x_1,x_2, \ldots),(s,\omega)) \in C$ and therefore $(s,\omega) \in \rho^X(C)$.
  It is straightforward that $\rho^X(C) \subseteq A$, and we conclude
  $A \in \mathcal{M}$.

  Now suppose $A_n \in \mathcal{M}$ with $A_n \uparrow A$. Let $X_n$ and $B_n$ be as before.
  Let $X' = \bigcup_{n=1}^\infty (X_n \times \{n\})$ with the topology generated by
  $\{G \times \{n\}: G \text{ open in } X_n\}$. Let $X$ be the one point
  compactification of $X'$. We can write $B_n = \bigcap_{m \in \mathbb{N}} B_{nm}$ with
  $B_{nm} \in \mathcal{L}_\sigma(X_n)$. Let
  $$C_{nm} = \{((x,n),(s,\omega)) \in X \times [0,t] \times \Omega: x \in X_n, (x,(s,\omega)) \in B_{nm}\},$$
  $C_n = \bigcap_{m \in \mathbb{N}} C_{nm}$, and $C = \bigcup_{n \in \mathbb{N}} C_n$.
  Then $C_{nm} \in \mathcal{L}_\sigma(X)$ and so $C_n \in \mathcal{L}_{\sigma\delta}(X)$.

  If $((x,p),(s,\omega)) \in \bigcap_{m \in \mathbb{N}} \bigcup_{n \in \mathbb{N}} C_{nm}$, then
  for each $m$ there exists $n_m$ such that $((x,p),(s,\omega)) \in C_{n_mm}$.
  This is
  only possible if $n_m = p$ for each $m$. Thus $((x,p), (s, \omega)) \in \bigcap_{m \in \mathbb{N}} C_{pm} = C_p \subseteq C$.
  The other inclusion is easier and we thus obtain $C = \bigcap_{m \in \mathbb{N}}\bigcup_{n \in \mathbb{N}} C_{nm}$,
  which implies $C \in \mathcal{L}_{\sigma\delta}(X)$. We check that
  $A = \rho^X(C)$ along the same lines, and therefore $A \in \mathcal{M}$.


  If $\mathcal{I}^0(t)$ is the collection of sets of the form $[a,b) \times C$, where
  $a < b \leq t$ and $C \in \mathcal{F}_t$, and $\mathcal{I}(t)$ is the collection of finite
  unions of sets in $\mathcal{I}^0(t)$, then $\mathcal{I}(t)$ is an algebra of sets. We
  note that $\mathcal{I}(t)$ generates the $\sigma$-field $\mathcal{B}[0,t] \times \mathcal{F}_t$. A set
  in $\mathcal{I}^0(t)$ of the form $[a,b) \times C$ is the union of sets in $\mathcal{K}^0(t)$
  of the form $[a, b-(1/m)] \times C$, and it
  follows that every set in $\mathcal{I}(t)$ is the increasing union of sets
  in $\mathcal{K}(t)$. Since $\mathcal{M}$ is a monotone
  class containing $\mathcal{K}(t)$, then $\mathcal{M}$ contains $\mathcal{I}(t)$.
  By the monotone class theorem (Theorem~\ref{thm:monotone_class}), $\mathcal{M} = \mathcal{B}[0,t] \times \mathcal{F}_t$.
\end{proof}


\begin{lemma}\label{lem:t_approx_of_Borel_measurable}
  \leanok
  \lean{MeasureTheory.Approximation.of_mem_prod_borel}
  \uses{def:t_approx_set}
If $A \in \mathcal{B}[0, t] \times \mathcal{F}_t$, then $A$ is $t$-approximable.
\end{lemma}

\begin{proof}
  \uses{lem:exists_cpct_Hausdorff}
  % See the proof of Lemma 2.6 in the corrected paper.
  %TODO: expand this proof, this may need some auxiliary lemmas. For now I just copy pasted the proof from the paper

  TODO: Reorganize this proof, possibly divide it in multiple lemmas.

  We first prove that if $H \in \mathcal{L}(X)$, then $\rho^X(H) \in \mathcal{K}_\delta$. If $H \in \mathcal{L}_1(X)$,
  this is clear. Suppose that $H_n \downarrow H$ with each $H_n \in \mathcal{L}_1(X)$.
  If $(s,\omega) \in \bigcap_{n \in \mathbb{N}} \rho^X(H_n)$, there exist
  $x_n \in X$ such that $(x_n,(s,\omega)) \in H_n$. Then there exists a subsequence
  such that $x_{n_k} \to x_\infty$ by the compactness of $X$. Now $(x_{n_k},(s,\omega)) \in H_{n_k}
  \subseteq H_m$ for $n_k$ larger than $m$. For fixed $\omega$, $\{(x,s): (x,(s,\omega)) \in H_m\}$
  is compact, so $(x_\infty,(s,\omega)) \in H_m$ for all $m$. This implies
  $(x_\infty,(s,\omega)) \in H$. The other inclusion is easier and therefore $\bigcap_{n \in \mathbb{N}} \rho^X(H_n) = \rho^X(H)$.
  Since $\rho^X(H_n) \in \mathcal{K}_\delta(t)$, then $\rho^X(H) \in \mathcal{K}_\delta(t)$.
  We also observe that for fixed $\omega$, $\{(x,s):(x,(s,\omega)) \in H\}$
  is compact.

  Now suppose $A \in \mathcal{B}[0,t] \times \mathcal{F}_t$. Then by Lemma~\ref{lem:exists_cpct_Hausdorff}
  there exists a compact Hausdorff space $X$ and $B \in \mathcal{L}_{\sigma\delta}(X)$ such that $A = \rho^X(B)$. We can write
  $B = \bigcap_{n \in \mathbb{N}} B_n$ and $B_n = \bigcup_{m \in \mathbb{N}} B_{nm}$ with $B_n \downarrow B$, $B_{nm} \uparrow B_n$, and $B_{nm} \in \mathcal{L}(X)$.

  Let $a = P^*(\pi(A)) = P^*(\pi \circ \rho^X(B))$ and let $\epsilon > 0$.
  By Lemma~\ref{lem:aux1b},
  $$P^*(\pi \circ \rho^X(B \cap B_{1m})) \uparrow P^*(\pi \circ \rho^X(B \cap B_1))
  = P^*(\pi \circ \rho^X(B)) = a.$$
  Take $m$ large enough so that $P^*(\pi \circ \rho^X(B \cap B_{1m})) > a - \epsilon$,
  let $C_1 = B_{1m}$, and $D_1 = B \cap C_1$.

  We proceed by induction. Suppose we are given sets $C_1, \ldots, C_{n-1}$ and
  sets $D_1, \ldots, D_{n-1}$ with $D_{n-1} = B \cap \left(\bigcap_{i=1}^{n-1} C_i\right)$, $P^*(\pi
  \circ \rho^X(D_{n-1})) > a - \epsilon$, and each $C_i = B_{im_i}$ for
  some $m_i$. Since $D_{n-1} \subseteq B \subseteq B_n$, by Lemma~\ref{lem:aux1b}
  $$P^*(\pi \circ \rho^X(D_{n-1} \cap B_{nm}))
  \uparrow P^*(\pi \circ \rho^X(D_{n-1} \cap B_n))
  = P^*(\pi \circ \rho^X(D_{n-1})).$$
  We can take $m$ large enough so that
  $P^*(\pi \circ \rho^X(D_{n-1} \cap B_{nm})) > a - \epsilon$, let $C_n = B_{nm}$, and $D_n = D_{n-1} \cap C_n$.

  If we let $G_n = C_1 \cap \cdots \cap C_n$ and $G = \bigcap_{n \in \mathbb{N}} G_n = \bigcap_{n \in \mathbb{N}} C_n$, then
  each $G_n$ is in $\mathcal{L}(X)$, hence $G \in \mathcal{L}(X)$. Since $C_n \subseteq B_n$, then
  $G \subseteq \bigcap_{n \in \mathbb{N}} B_n = B$.
  Each $G_n \in \mathcal{L}(X)$ and so by the first paragraph of this proof, for each
  fixed $\omega$ and $n$, $\{(x,s): (x,(s,\omega)) \in G_n\}$
  is compact. Hence, by a proof very similar to that of Lemma~\ref{lem:iInf_snd_eq_snd_iInf},
  $\pi \circ \rho^X(G_n) \downarrow \pi \circ \rho^X(G)$.
  Using the first paragraph of this proof and Lemma~\ref{lem:iInf_snd_eq_snd_iInf},
  we see that $$P(\pi \circ \rho^X(G))
  = \lim_{n \to \infty} P(\pi \circ \rho^X(G_n)) \geq \lim_{n \to \infty} P^*(\pi \circ \rho^X(D_n)) \geq a - \epsilon.$$

  Using the first paragraph of this proof once again, we see that $A$ is $t$-approximable.
\end{proof}


\begin{theorem}\label{thm:debut_of_progr_meas_is_stop_time}
  \leanok
  \lean{MeasureTheory.isStoppingTime_debut}
  \uses{def:progr_meas_set, def:debut_set, def:IsStoppingTime}
If $E$ is a progressively measurable set, then $D_E$ is a stopping time.
\end{theorem}

\begin{proof}
  \uses{def:t_approx_set, lem:t_approx_of_Borel_measurable, lem:measurable_of_t_approx}
  % See the proof of Theorem 2.1 in the corrected paper.
  % TODO: It seems we need right continuity of the filtration, should we state it as an assumption?
  Let $E$ be a progressively measurable set and let $A_u = E \cap ([0,u] \times \Omega)$.
  By Lemma~\ref{lem:t_approx_of_Borel_measurable}, $A_u$ is $u$-approximable.
  By Lemma~\ref{lem:measurable_of_t_approx}, $\pi(A_u) \in \mathcal{F}_u$.
  Now fix $t$. If $\omega \in \{D_E \leq t\}$, we see that $\omega \in \pi(A_u)$ for all $u > t$.
  Conversely, if $\omega \in \pi(A_u)$ for all $u > t$, then $\omega \in \{D_E \leq t\}$.
  If $u_1 < u_2$, then $A_{u_1} \subseteq A_{u_2}$ and hence $\pi(A_{u_1}) \subseteq
  \pi(A_{u_2})$. Therefore
  $$\{D_E \leq t\} = \bigcap_{u > t} \pi(A_u) \in \bigcap_{u > t} \mathcal{F}_u = \mathcal{F}_t.$$
  Because $t$ was arbitrary, we conclude $D_E$ is a stopping time.
\end{proof}




\section{Hitting times}

% TODO: do we want to do the same distinction that the paper makes between the hitting time and the entry time?
% In the paper they are defined as follows:
% Entry time: inf{t \geq 0: X_t \in B}
% Hitting time: inf{t > 0: X_t \in B}
% What we call hitting time in Mathlib is actually a generalization of the entry time, but does not completely cover the hitting time. In case we would like to have both we may want to define another version of the hitting time with the strict inequality (essentially with Set.Ioc or Set.Ioo instead of Set.Icc).
% For the moment this does not seem necessary, and in any case the proof for the hitting time relies on the one for the entry time and takes a limit, so we can always add it later if needed.

\begin{theorem}\label{thm:hitting_is_stopping_time}
  \leanok
  \lean{MeasureTheory.isStoppingTime_hittingAfter'}
  \uses{def:IsStoppingTime, def:hittingAfter, def:ProgMeasurable, def:rightContinuous}
  \notready
If $X : T \to \Omega \to E$ is a progressively measurable process with respect to a right-continuous filtration and $B$ is a Borel-measurable subset of $E$, then the hitting time of $X$ in $B$ is a stopping time.
\end{theorem}

\begin{proof}
  \uses{thm:debut_of_progr_meas_is_stop_time, lem:rightContinuous_basic}
  % See the proof of Theorem 2.7 in the corrected paper.
  Since $B$ is a Borel subset of $\mathcal{S}$ and $X$ is progressively measurable,
  then $\mathbf{1}_B(X_t)$ is also progressively measurable. The hitting time is then the debut of the set
  $E = \{(s,\omega) : \mathbf{1}_B(X_s(\omega)) = 1\}$, and therefore is a stopping time by Theorem~\ref{thm:debut_of_progr_meas_is_stop_time}.
\end{proof}




\section{Corollaries}


\begin{definition}\label{def:leastGE}
  \mathlibok
  \lean{MeasureTheory.leastGE}
For a process $X : Œπ \to Œ© \to ‚Ñù$ and a real number $a$, define the random time
\begin{align*}
  \tau_{X \ge a} = \inf\{t \in Œπ \mid X_t \ge a\} \: ,
\end{align*}
in which the infimum is infinite if the set is empty.
\end{definition}


\begin{lemma}\label{lem:isStoppingTime_leastGE}
  \uses{def:IsStoppingTime, def:leastGE}
If $X : Œπ \to Œ© \to ‚Ñù$ is a progressively measurable process with respect to a right-continuous filtration, then for any $a \in \mathbb{R}$, the random time $\tau_{X \ge a}$ is a stopping time.
\end{lemma}

\begin{proof}
  \uses{thm:hitting_is_stopping_time}
This is a direct application of Theorem~\ref{thm:hitting_is_stopping_time} with the set $B = [a, +\infty)$.
\end{proof}


\begin{corollary}\label{cor:isStoppingTime_leastGE_of_rightContinuous}
  \uses{def:IsStoppingTime, def:leastGE, def:rightContinuous, def:adapted, def:RightContinuous}
If $X : Œπ \to Œ© \to ‚Ñù$ is a right-continuous and adapted process with respect to a right-continuous filtration, then for any $a \in \mathbb{R}$, the random time $\tau_{X \ge a}$ is a stopping time.
\end{corollary}

\begin{proof}
  \uses{lem:isStoppingTime_leastGE, lem:Adapted.progMeasurable_of_rightContinuous}
This follows from Lemma~\ref{lem:isStoppingTime_leastGE} since $X$ is progressively measurable by Lemma~\ref{lem:Adapted.progMeasurable_of_rightContinuous}.
\end{proof}
